<!DOCTYPE html>
<html>
<head>
    <title>Test File Mapping</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>Test File Data Mapping</h1>
    <button onclick="testMapping()">Test API Response Mapping</button>
    <div id="results"></div>

    <script>
        function addResult(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }

        async function testMapping() {
            document.getElementById('results').innerHTML = '';
            
            try {
                addResult('üîç Fetching files from API...', 'info');
                const response = await fetch('/api/s3/files?user_id=admin');
                const data = await response.json();
                
                addResult(`‚úÖ API Response: ${JSON.stringify(data, null, 2)}`, 'success');
                
                if (data.success && data.files) {
                    addResult('üîÑ Testing data mapping...', 'info');
                    
                    const mappedFiles = data.files.map(file => ({
                        ...file,
                        // Legacy fields
                        key: file.file_key,
                        name: file.file_name,
                        size: file.file_size,
                        last_modified: file.upload_date,
                        folder: file.s3_bucket || ''
                    }));
                    
                    addResult(`‚úÖ Mapped Files: ${JSON.stringify(mappedFiles, null, 2)}`, 'success');
                    
                    // Test formatFileSize function
                    function formatFileSize(bytes) {
                        if (bytes === 0) return '0 Bytes';
                        const k = 1024;
                        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                        const i = Math.floor(Math.log(bytes) / Math.log(k));
                        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                    }
                    
                    addResult('üìä Testing file display format:', 'info');
                    mappedFiles.forEach((file, index) => {
                        const sizeStr = formatFileSize(file.size);
                        const dateStr = new Date(file.last_modified).toLocaleDateString();
                        addResult(`File ${index + 1}: <strong>${file.name}</strong><br>Size: ${sizeStr} ‚Ä¢ Date: ${dateStr}`, 'success');
                    });
                    
                } else {
                    addResult('‚ùå No files found or API error', 'error');
                }
                
            } catch (error) {
                addResult(`‚ùå Error: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
